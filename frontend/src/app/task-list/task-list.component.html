<div class="container-wrapper">
  <div class="task-container">
    <div class="filters">
      <div class="filter-item">
        <input
          [(ngModel)]="filterCriteria.contactPerson"
          placeholder="Filter Contact Person"
          (input)="applyFilters()"
        />
      </div>

      <div class="filter-item">
        <input
          [(ngModel)]="filterCriteria.entityName"
          placeholder="Filter Entity Name"
          (input)="applyFilters()"
        />
      </div>

      <div class="filter-item">
        <input
          [(ngModel)]="filterCriteria.taskType"
          placeholder="Filter Task Type"
          (input)="applyFilters()"
        />
      </div>

      <div class="filter-item">
        <select [(ngModel)]="filterCriteria.status" (change)="applyFilters()">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="completed">Completed</option>
        </select>
      </div>

      <div class="filter-item">
        <input
          type="date"
          [(ngModel)]="filterCriteria.date"
          (change)="applyFilters()"
        />
      </div>
    </div>

    <table class="tasks-table">
      <thead>
        <tr>
          <th (click)="toggleSort('contact_person')" style="width: 20%">
            Contact Person
            <span *ngIf="sortField === 'contact_person'">
              {{ sortDirection === "asc" ? "↑" : "↓" }}
            </span>
          </th>
          <th (click)="toggleSort('entity_name')" style="width: 20%">
            Entity Name
            <span *ngIf="sortField === 'entity_name'">
              {{ sortDirection === "asc" ? "↑" : "↓" }}
            </span>
          </th>
          <th (click)="toggleSort('task_type')" style="width: 20%">
            Task Type
            <span *ngIf="sortField === 'task_type'">
              {{ sortDirection === "asc" ? "↑" : "↓" }}
            </span>
          </th>
          <th (click)="toggleSort('status')" style="width: 15%">
            Status
            <span *ngIf="sortField === 'status'">
              {{ sortDirection === "asc" ? "↑" : "↓" }}
            </span>
          </th>
          <th (click)="toggleSort('task_time')" style="width: 15%">
            Date
            <span *ngIf="sortField === 'task_time'">
              {{ sortDirection === "asc" ? "↑" : "↓" }}
            </span>
          </th>
          <th style="width: 10%">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let task of filteredTasks">
          <td>{{ task.contact_person }}</td>
          <td>{{ task.entity_name }}</td>
          <td>{{ task.task_type }}</td>
          <td>{{ task.status }}</td>
          <td>{{ task.task_time | date }}</td>
          <td class="actions">
            <button class="btn btn-sm btn-primary" (click)="editTask(task)">
              Edit
            </button>
            <button class="btn btn-sm btn-info" (click)="duplicateTask(task)">
              Duplicate
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteTask(task.id)">
              Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>

    <app-task-edit-modal
      *ngIf="showEditModal"
      [task]="editingTask!"
      [show]="showEditModal"
      (save)="onTaskSave($event)"
      (close)="onModalClose()"
    >
    </app-task-edit-modal>
  </div>
</div>
